#!/bin/bash

# This script creates a new git branch, pushes it to the remote repository,
# and sets up a git worktree for that branch in a directory named
# "../<repository_name>_<branch_name>". It takes the branch name as an argument
# and outputs the path to the created worktree.
# Usage, inside a git repository you want to create a branch and worktree for:
#   gwa <branch_name>
# Usage with cding into the worktree:
#   cd "$(gwa <branch_name>)"

repo_name=$(basename "$(git rev-parse --show-toplevel)")
branch_name="$1"

# create branch without switching
git branch "$branch_name" &> /dev/null
git push -u origin "$branch_name" &> /dev/null
cd "$(git rev-parse --show-toplevel)" || exit 1
worktree_path="../${repo_name}_${branch_name}"
git worktree add "$worktree_path" "$branch_name" &> /dev/null
echo "$worktree_path"
