#!/bin/bash
DOTFILES=~/dotfiles
mkdir -p ~/bin
mkdir -p ~/.config
ln -sf $DOTFILES/bin/dotfilesUpdate ~/bin/dotfilesUpdate

### install packages
PCKMGR='sudo apt -yq install'
if [ -n "$(command -v yum)" ]; then
  PCKMGR='sudo yum -y install'
fi
if [ -n "$(command -v pacman)" ]; then
  PCKMGR='sudo pacman -Sy --noconfirm'
fi
if [ ! -n "$(command -v zsh)" ]; then $PCKMGR zsh; fi
if [ ! -n "$(command -v vim)" ]; then $PCKMGR vim; fi
if [ ! -n "$(command -v vifm)" ]; then $PCKMGR vifm; fi
if [ ! -n "$(command -v tmux)" ]; then $PCKMGR tmux; fi
if [ ! -n "$(command -v fdfind)" ]; then $PCKMGR fd-find; fi

### oh-my-zsh install
if [ ! -d ~/.oh-my-zsh ]; then
  sh -c "$(wget -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
fi
if [ ! -d ~/.oh-my-zsh/plugins ]; then
  mkdir -p ~/.oh-my-zsh/plugins
fi
if [ ! -d ~/.oh-my-zsh/plugins/zsh-autosuggestions ]; then
	git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
fi
# additional themes
wget https://raw.githubusercontent.com/moarram/headline/main/headline.zsh-theme -O ~/.oh-my-zsh/themes/headline.zsh-theme
git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ~/.oh-my-zsh/custom/themes/powerlevel10k

### Tmux
if [ ! -d ~/.tmux/plugins ]; then
  mkdir -p ~/.tmux/plugins
  git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
fi

### Various
ln -sf $DOTFILES/.bashrc ~/.bashrc
ln -sf $DOTFILES/.ctags ~/.ctags
ln -sf $DOTFILES/.dircolors ~/.dircolors
ln -sf $DOTFILES/.tmux.conf ~/.tmux.conf
ln -sf $DOTFILES/.tmuxp ~/.tmuxp
ln -sf $DOTFILES/.vifm ~/.vifm
ln -sf $DOTFILES/.zshrc ~/.zshrc
if [ -d ~/.oh-my-zsh ]; then
  ln -sf $DOTFILES/.oh-my-zsh/themes/rzabcio.zsh-theme ~/.oh-my-zsh/themes/rzabcio.zsh-theme
fi

### Vim
ln -sf $DOTFILES/.vimrc ~/.vimrc
mkdir -p ~/.vim/swapfiles
ln -sf $DOTFILES/.vim/autoload ~/.vim/autoload
vim +'PlugInstall --sync' +qa

### NVim
ln -sf $DOTFILES/.config/nvim ~/.config/nvim
nvim +'PackerLoad' +qa
nvim +'PackerInstall' +qa

### Ranger
ln -sf $DOTFILES/.config/ranger ~/.config/ranger

### WSL
WIN_HOME_DIR=/mnt/c/Users/jglazik
if [ -d "$WIN_HOME_DIR" ]; then
  mkdir -p $WIN_HOME_DIR/.vim/autoload
  cp $DOTFILES/.vim/autoload/plug.vim $WIN_HOME_DIR/.vim/autoload/plug.vim
  cp $DOTFILES/.vimrc $WIN_HOME_DIR
fi
